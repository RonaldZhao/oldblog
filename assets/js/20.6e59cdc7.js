(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{185:function(s,t,n){"use strict";n.r(t);var a=n(0),e=Object(a.a)({},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"content"},[s._m(0),s._v(" "),n("p"),s._m(1),n("p"),s._v(" "),s._m(2),s._v(" "),n("p",[s._v("CentOS 7.4")]),s._v(" "),s._m(3),s._v(" "),s._m(4),s._v(" "),s._m(5),s._m(6),s._v(" "),n("p",[s._v("问题一：nginx未设置开机启动，所以如果服务器重启就需要手动启动nginx。")]),s._v(" "),s._m(7),s._v(" "),n("p",[s._v("问题二：nginx还未与博客目录、域名绑定 。")]),s._v(" "),n("p",[s._v("解决方法：")]),s._v(" "),s._m(8),s._v(" "),s._m(9),n("p",[s._v("打开default.conf文件后修改server的花括号之间的以下几项：")]),s._v(" "),s._m(10),s._v(" "),s._m(11),s._v(" "),n("ol",[n("li",[n("p",[s._v("首先去"),n("a",{attrs:{href:"https://common-buy.aliyun.com/?spm=5176.2020520163.cas.1.7f850e31atqmMO&commodityCode=cas#/buy",target:"_blank",rel:"noopener noreferrer"}},[s._v("阿里云"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://console.cloud.tencent.com/ssl/apply",target:"_blank",rel:"noopener noreferrer"}},[s._v("腾讯云"),n("OutboundLink")],1),s._v("、"),n("a",{attrs:{href:"https://portal.qiniu.com/certificate/apply",target:"_blank",rel:"noopener noreferrer"}},[s._v("七牛云"),n("OutboundLink")],1),s._v("等申请个免费的https证书。")])]),s._v(" "),s._m(12),s._v(" "),s._m(13)]),s._v(" "),s._m(14),s._v(" "),s._m(15)])},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"阿里云ecs服务器安装nginx1-12-2、配置博客目录并开启https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里云ecs服务器安装nginx1-12-2、配置博客目录并开启https","aria-hidden":"true"}},[this._v("#")]),this._v(" 阿里云ECS服务器安装nginx1.12.2、配置博客目录并开启https")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#服务器系统"}},[this._v("服务器系统")])]),t("li",[t("a",{attrs:{href:"#安装"}},[this._v("安装")])]),t("li",[t("a",{attrs:{href:"#配置"}},[this._v("配置")])]),t("li",[t("a",{attrs:{href:"#开启https"}},[this._v("开启https")])]),t("li",[t("a",{attrs:{href:"#重启nginx"}},[this._v("重启nginx")])])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"服务器系统"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器系统","aria-hidden":"true"}},[this._v("#")]),this._v(" 服务器系统")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[this._v("#")]),this._v(" 安装")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("下面的命令都是在root权限下执行，非root需要使用sudo。如："),t("code",[this._v("sudo yum")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# vim /etc/yum.repos.d/nginx.repo # 进入后先按小写 **a** ，然后粘贴如下内容，然后按 **esc** ，然后输入 **:wq** 回车退出。")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nginx"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nname"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx repo\nbaseurl"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("http://nginx.org/packages/centos/7/"),n("span",{attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/\ngpgcheck"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0\nenabled"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("1\n"),n("span",{attrs:{class:"token comment"}},[s._v("# yum install nginx")]),s._v("\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n"),n("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("# systemctl start nginx")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("# systemctl status nginx # 可见输出的第二行如下")]),s._v("\n● nginx.service - nginx - high performance web server\n   Loaded: loaded "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/nginx.service"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" disabled"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   Active: **active "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("running"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("** since Wed 2017-11-01 16:23:32 CST"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 14s ago\n     Docs: http://nginx.org/en/docs/\n  Process: 10379 ExecStart"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx -c /etc/nginx/nginx.conf "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, status"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0/SUCCESS"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Process: 10378 ExecStartPre"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/sbin/nginx -t -c /etc/nginx/nginx.conf "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, status"),n("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("0/SUCCESS"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n Main PID: 10382 "),n("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nginx"),n("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/nginx.service\n           ├─10382 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf\n           └─10383 nginx: worker process\nNov 01 16:23:32 jesuszhao systemd"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting nginx - high performance web server"),n("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nNov 01 16:23:32 jesuszhao nginx"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10378"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": nginx: the configuration "),n("span",{attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf syntax is ok\nNov 01 16:23:32 jesuszhao nginx"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("10378"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": nginx: configuration "),n("span",{attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf "),n("span",{attrs:{class:"token function"}},[s._v("test")]),s._v(" is successful\nNov 01 16:23:32 jesuszhao systemd"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Failed to "),n("span",{attrs:{class:"token function"}},[s._v("read")]),s._v(" PID from "),n("span",{attrs:{class:"token function"}},[s._v("file")]),s._v(" /var/run/nginx.pid: Invalid argument\nNov 01 16:23:32 jesuszhao systemd"),n("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1"),n("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started nginx - high performance web server.\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("解决方法： 执行"),t("code",[this._v("# systemctl enable nginx.service")]),this._v("，然后重启服务器即可。")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("首先你要决定把博客目录放在哪里，然后在那里新建一个文件夹并把博客的所有文件上传到那个文件夹下，比如："),t("code",[this._v("/var/www/blog")]),this._v("目录，然后配置"),t("code",[this._v("nginx")]),this._v("：")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{attrs:{class:"token comment"}},[this._v("# cd /etc/nginx/conf.d/")]),this._v("\n"),t("span",{attrs:{class:"token comment"}},[this._v("# vim default.conf # 最好先备份：cp default.conf default.conf.bak")]),this._v("\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ol",[n("li",[n("strong",[s._v("server_name")]),s._v("：改成你的域名，如："),n("code",[s._v("ronaldzhao.top")]),s._v("（不要带http或https前缀）")]),s._v(" "),n("li",[n("strong",[s._v("root")]),s._v("：改成你的博客目录的路径，如："),n("code",[s._v("/var/www/blog")])]),s._v(" "),n("li",[n("strong",[s._v("index")]),s._v(": 改成你的博客文件的首页文件名，如："),n("code",[s._v("index.html")])])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"开启https"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#开启https","aria-hidden":"true"}},[this._v("#")]),this._v(" 开启https")])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("li",[n("p",[s._v("待证书发下来后把nginx版的下载下来，然后登录ECS创建以下目录：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# cd /etc/nginx/")]),s._v("\n"),n("span",{attrs:{class:"token comment"}},[s._v("# mkdir cert")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("然后使用"),n("code",[s._v("FileZilla")]),s._v("把下载下来的文件（一般是两个，一个"),n("code",[s._v(".pem")]),s._v("的，一个"),n("code",[s._v(".key")]),s._v("的）上传到新建的cert目录里。")])])},function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("li",[n("p",[s._v("再次编辑nginx配置文件"),n("code",[s._v("default.conf")]),s._v("：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{attrs:{class:"token comment"}},[s._v("# vim default.conf # 然后在文件的最前面添加以下内容，注意几个地方要根据你的情况填写")]),s._v("\nserver "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen 443"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.yourdomain.com"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("#填写绑定证书的域名")]),s._v("\n        ssl on"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate cert/your_file_name.pem"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate_key cert/your_file_name.key"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_session_timeout 5m"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_protocols TLSv1 TLSv1.1 TLSv1.2"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("#按照这个协议配置")]),s._v("\n        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:"),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("aNULL:"),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("MD5:"),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("RC4:"),n("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v("DHE"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{attrs:{class:"token comment"}},[s._v("#按照这个套件配置")]),s._v("\n        ssl_prefer_server_ciphers on"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        location / "),n("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            root   html"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{attrs:{class:"token comment"}},[s._v("#站点目录")]),s._v("\n            index  index.html index.htm"),n("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("p",[s._v("注意不是把原来的server{….}那一堆覆盖。")]),s._v(" "),n("p",[s._v("其中的"),n("strong",[s._v("server_name")]),s._v("、"),n("strong",[s._v("root")]),s._v("、"),n("strong",[s._v("index")]),s._v("三项修改为和之前修改的一致。")]),s._v(" "),n("p",[s._v("然后在原来的server{…..}那一堆中的**location / {…}**的任意一行添加 "),n("strong",[s._v("rewrite ^(.*) https://$host$1 permanent;")]),s._v(" 强制http为https访问，开启全站https。（可选）")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"重启nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#重启nginx","aria-hidden":"true"}},[this._v("#")]),this._v(" 重启nginx")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{attrs:{class:"token comment"}},[this._v("# systemctl restart nginx")]),this._v("\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])}],!1,null,null,null);e.options.__file="README.md";t.default=e.exports}}]);
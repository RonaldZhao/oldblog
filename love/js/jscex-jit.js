// build time:Mon Nov 13 2017 19:24:11 GMT+0800 (CST)
(function(){var codeGenerator=typeof eval("(function () {})")=="function"?function(t){return t}:function(t){return"false || "+t};var stringify=typeof JSON!=="undefined"&&JSON.stringify?function(t){return JSON.stringify(t)}:function(){var t=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(e){t.lastIndex=0;return t.test(e)?'"'+e.replace(t,function(t){var e=i[t];return typeof e==="s"?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}}();if(typeof __jscex__tempVarSeed==="undefined"){__jscex__tempVarSeed=0}var init=function(t){if(t.modules["jit"]){return}function i(t){this._binder=t;this._root=null}i.prototype={generate:function(t){var i=t[2],e=t[3];this._root={type:"delay",stmts:[]};this._visitStatements(e,this._root.stmts);return this._root},_getBindInfo:function(t){var i=t[0];if(i=="stat"){var e=t[1];if(e[0]=="call"){var s=e[1];if(s[0]=="name"&&s[1]==this._binder&&e[2].length==1){return{expression:e[2][0],argName:"",assignee:null}}}else if(e[0]=="assign"){var n=e[2];e=e[3];if(e[0]=="call"){var s=e[1];if(s[0]=="name"&&s[1]==this._binder&&e[2].length==1){return{expression:e[2][0],argName:"$$_result_$$",assignee:n}}}}}else if(i=="var"){var r=t[1];if(r.length==1){var _=r[0];var a=_[0];var e=_[1];if(e&&e[0]=="call"){var s=e[1];if(s[0]=="name"&&s[1]==this._binder&&e[2].length==1){return{expression:e[2][0],argName:a,assignee:null}}}}}else if(i=="return"){var e=t[1];if(e&&e[0]=="call"){var s=e[1];if(s[0]=="name"&&s[1]==this._binder&&e[2].length==1){return{expression:e[2][0],argName:"$$_result_$$",assignee:"return"}}}}return null},_visitStatements:function(t,i,e){if(arguments.length<=2)e=0;if(e>=t.length){i.push({type:"normal"});return this}var s=t[e];var n=this._getBindInfo(s);if(n){var r={type:"bind",info:n};i.push(r);if(n.assignee!="return"){r.stmts=[];this._visitStatements(t,r.stmts,e+1)}}else{var _=s[0];if(_=="return"||_=="break"||_=="continue"||_=="throw"){i.push({type:_,stmt:s})}else if(_=="if"||_=="try"||_=="for"||_=="do"||_=="while"||_=="switch"||_=="for-in"){var a=this._visit(s);if(a.type=="raw"){i.push(a);this._visitStatements(t,i,e+1)}else{var h=e==t.length-1;if(h){i.push(a)}else{var o={type:"combine",first:{type:"delay",stmts:[a]},second:{type:"delay",stmts:[]}};i.push(o);this._visitStatements(t,o.second.stmts,e+1)}}}else{i.push({type:"raw",stmt:s});this._visitStatements(t,i,e+1)}}return this},_visit:function(t){var i=t[0];function e(){throw new Error('"'+i+'" is not currently supported.')}var s=this._visitors[i];if(s){return s.call(this,t)}else{e()}},_visitBody:function(t,i){if(t[0]=="block"){this._visitStatements(t[1],i)}else{this._visitStatements([t],i)}},_noBinding:function(t){switch(t[t.length-1].type){case"normal":case"return":case"break":case"throw":case"continue":return true}return false},_collectCaseStatements:function(t,i){var e=[];for(var s=i;s<t.length;s++){var n=t[s][1];for(var r=0;r<n.length;r++){if(n[r][0]=="break"){return e}e.push(n[r])}}return e},_visitors:{"for":function(t){var i=[];var e=t[4];this._visitBody(e,i);if(this._noBinding(i)){return{type:"raw",stmt:t}}var s={type:"delay",stmts:[]};var n=t[1];if(n){s.stmts.push({type:"raw",stmt:n})}var r={type:"loop",bodyFirst:false,bodyStmt:{type:"delay",stmts:i}};s.stmts.push(r);var _=t[2];if(_){r.condition=_}var a=t[3];if(a){r.update=a}return s},"for-in":function(i){var e=i[4];var s=[];this._visitBody(e,s);if(this._noBinding(s)){return{type:"raw",stmt:i}}var n=__jscex__tempVarSeed++;var r="$$_keys_$$_"+n;var _="$$_index_$$_"+n;var a={type:"delay",stmts:[]};var h=t.parse("var "+r+" = Jscex._forInKeys(obj);")[1][0];h[1][0][1][2][0]=i[3];a.stmts.push({type:"raw",stmt:h});a.stmts.push({type:"raw",stmt:t.parse("var "+_+" = 0;")[1][0]});var o=t.parse(_+" < "+r+".length")[1][0][1];var w=t.parse(_+"++")[1][0][1];var v={type:"loop",bodyFirst:false,update:w,condition:o,bodyStmt:{type:"delay",stmts:[]}};a.stmts.push(v);var f=i[2][1];if(i[1][0]=="var"){v.bodyStmt.stmts.push({type:"raw",stmt:t.parse("var "+f+" = "+r+"["+_+"];")[1][0]})}else{v.bodyStmt.stmts.push({type:"raw",stmt:t.parse(f+" = "+r+"["+_+"];")[1][0]})}this._visitBody(e,v.bodyStmt.stmts);return a},"while":function(t){var i=[];var e=t[2];this._visitBody(e,i);if(this._noBinding(i)){return{type:"raw",stmt:t}}var s={type:"loop",bodyFirst:false,bodyStmt:{type:"delay",stmts:i}};var n=t[1];s.condition=n;return s},"do":function(t){var i=[];var e=t[2];this._visitBody(e,i);if(this._noBinding(i)){return{type:"raw",stmt:t}}var s={type:"loop",bodyFirst:true,bodyStmt:{type:"delay",stmts:i}};var n=t[1];s.condition=n;return s},"switch":function(t){var i=true;var e={type:"switch",item:t[1],caseStmts:[]};var s=t[2];for(var n=0;n<s.length;n++){var r={item:s[n][0],stmts:[]};e.caseStmts.push(r);var _=this._collectCaseStatements(s,n);this._visitStatements(_,r.stmts);i=i&&this._noBinding(r.stmts)}if(i){return{type:"raw",stmt:t}}else{return e}},"if":function(t){var i=true;var e={type:"if",conditionStmts:[]};var s=t;while(true){var n=s[1];var r={cond:n,stmts:[]};e.conditionStmts.push(r);var _=s[2];this._visitBody(_,r.stmts);i=i&&this._noBinding(r.stmts);var a=s[3];if(a&&a[0]=="if"){s=a}else{break}}var a=s[3];if(a){e.elseStmts=[];this._visitBody(a,e.elseStmts);i=i&&this._noBinding(e.elseStmts)}if(i){return{type:"raw",stmt:t}}else{return e}},"try":function(t,i){var e=[];var s=t[1];this._visitStatements(s,e);var n=this._noBinding(e);var r={type:"try",bodyStmt:{type:"delay",stmts:e}};var _=t[2];if(_){var a=_[0];r.exVar=a;r.catchStmts=[];this._visitStatements(_[1],r.catchStmts);n=n&&this._noBinding(r.catchStmts)}var h=t[3];if(h){r.finallyStmt={type:"delay",stmts:[]};this._visitStatements(h,r.finallyStmt.stmts);n=n&&this._noBinding(r.finallyStmt.stmts)}if(n){return{type:"raw",stmt:t}}else{return r}}}};function e(t,i,e){this._builderName=t;this._binder=i;this._normalMode=false;this._indent=e;this._indentLevel=0;this._builderVar="$$_builder_$$_"+__jscex__tempVarSeed++}e.prototype={_write:function(t){this._buffer.push(t);return this},_writeLine:function(t){this._write(t)._write("\n");return this},_writeIndents:function(){for(var t=0;t<this._indent;t++){this._write(" ")}for(var t=0;t<this._indentLevel;t++){this._write("    ")}return this},generate:function(t,i){this._buffer=[];this._writeLine("(function ("+t.join(", ")+") {");this._indentLevel++;this._writeIndents()._writeLine("var "+this._builderVar+" = Jscex.builders["+stringify(this._builderName)+"];");this._writeIndents()._writeLine("return "+this._builderVar+".Start(this,");this._indentLevel++;this._pos={};this._writeIndents()._visitJscex(i)._writeLine();this._indentLevel--;this._writeIndents()._writeLine(");");this._indentLevel--;this._writeIndents()._write("})");return this._buffer.join("")},_visitJscex:function(t){this._jscexVisitors[t.type].call(this,t);return this},_visitRaw:function(t){var i=t[0];function e(){throw new Error('"'+i+'" is not currently supported.')}var s=this._rawVisitors[i];if(s){s.call(this,t)}else{e()}return this},_visitJscexStatements:function(t){for(var i=0;i<t.length;i++){var e=t[i];if(e.type=="raw"||e.type=="if"||e.type=="switch"){this._writeIndents()._visitJscex(e)._writeLine()}else if(e.type=="delay"){this._visitJscexStatements(e.stmts)}else{this._writeIndents()._write("return ")._visitJscex(e)._writeLine(";")}}},_visitRawStatements:function(t){for(var i=0;i<t.length;i++){var e=t[i];this._writeIndents()._visitRaw(e)._writeLine();switch(e[0]){case"break":case"return":case"continue":case"throw":return}}},_visitRawBody:function(t){if(t[0]=="block"){this._visitRaw(t)}else{this._writeLine();this._indentLevel++;this._writeIndents()._visitRaw(t);this._indentLevel--}return this},_visitRawFunction:function(t){var i=t[1]||"";var e=t[2];var s=t[3];this._writeLine("function "+i+"("+e.join(", ")+") {");this._indentLevel++;var n=this._pos.inFunction;this._pos.inFunction=true;this._visitRawStatements(s);this._indentLevel--;this._pos.inFunction=n;this._writeIndents()._write("}")},_jscexVisitors:{delay:function(t){if(t.stmts.length==1){var i=t.stmts[0];switch(i.type){case"delay":case"combine":case"normal":case"break":case"continue":case"loop":case"try":this._visitJscex(i);return;case"return":if(!i.stmt[1]){this._visitJscex(i);return}}}this._writeLine(this._builderVar+".Delay(function () {");this._indentLevel++;this._visitJscexStatements(t.stmts);this._indentLevel--;this._writeIndents()._write("})")},combine:function(t){this._writeLine(this._builderVar+".Combine(");this._indentLevel++;this._writeIndents()._visitJscex(t.first)._writeLine(",");this._writeIndents()._visitJscex(t.second)._writeLine();this._indentLevel--;this._writeIndents()._write(")")},loop:function(t){this._writeLine(this._builderVar+".Loop(");this._indentLevel++;if(t.condition){this._writeIndents()._writeLine("function () {");this._indentLevel++;this._writeIndents()._write("return ")._visitRaw(t.condition)._writeLine(";");this._indentLevel--;this._writeIndents()._writeLine("},")}else{this._writeIndents()._writeLine("null,")}if(t.update){this._writeIndents()._writeLine("function () {");this._indentLevel++;this._writeIndents()._visitRaw(t.update)._writeLine(";");this._indentLevel--;this._writeIndents()._writeLine("},")}else{this._writeIndents()._writeLine("null,")}this._writeIndents()._visitJscex(t.bodyStmt)._writeLine(",");this._writeIndents()._writeLine(t.bodyFirst);this._indentLevel--;this._writeIndents()._write(")")},raw:function(t){this._visitRaw(t.stmt)},bind:function(t){var i=t.info;this._write(this._builderVar+".Bind(")._visitRaw(i.expression)._writeLine(", function ("+i.argName+") {");this._indentLevel++;if(i.assignee=="return"){this._writeIndents()._writeLine("return "+this._builderVar+".Return("+i.argName+");")}else{if(i.assignee){this._writeIndents()._visitRaw(i.assignee)._writeLine(" = "+i.argName+";")}this._visitJscexStatements(t.stmts)}this._indentLevel--;this._writeIndents()._write("})")},"if":function(t){for(var i=0;i<t.conditionStmts.length;i++){var e=t.conditionStmts[i];this._write("if (")._visitRaw(e.cond)._writeLine(") {");this._indentLevel++;this._visitJscexStatements(e.stmts);this._indentLevel--;this._writeIndents()._write("} else ")}this._writeLine("{");this._indentLevel++;if(t.elseStmts){this._visitJscexStatements(t.elseStmts)}else{this._writeIndents()._writeLine("return "+this._builderVar+".Normal();")}this._indentLevel--;this._writeIndents()._write("}")},"switch":function(t){this._write("switch (")._visitRaw(t.item)._writeLine(") {");this._indentLevel++;for(var i=0;i<t.caseStmts.length;i++){var e=t.caseStmts[i];if(e.item){this._writeIndents()._write("case ")._visitRaw(e.item)._writeLine(":")}else{this._writeIndents()._writeLine("default:")}this._indentLevel++;this._visitJscexStatements(e.stmts);this._indentLevel--}this._writeIndents()._write("}")},"try":function(t){this._writeLine(this._builderVar+".Try(");this._indentLevel++;this._writeIndents()._visitJscex(t.bodyStmt)._writeLine(",");if(t.catchStmts){this._writeIndents()._writeLine("function ("+t.exVar+") {");this._indentLevel++;this._visitJscexStatements(t.catchStmts);this._indentLevel--;this._writeIndents()._writeLine("},")}else{this._writeIndents()._writeLine("null,")}if(t.finallyStmt){this._writeIndents()._visitJscex(t.finallyStmt)._writeLine()}else{this._writeIndents()._writeLine("null")}this._indentLevel--;this._writeIndents()._write(")")},normal:function(t){this._write(this._builderVar+".Normal()")},"throw":function(t){this._write(this._builderVar+".Throw(")._visitRaw(t.stmt[1])._write(")")},"break":function(t){this._write(this._builderVar+".Break()")},"continue":function(t){this._write(this._builderVar+".Continue()")},"return":function(t){this._write(this._builderVar+".Return(");if(t.stmt[1])this._visitRaw(t.stmt[1]);this._write(")")}},_rawVisitors:{"var":function(t){this._write("var ");var i=t[1];for(var e=0;e<i.length;e++){this._write(i[e][0]);if(i[e].length>1){this._write(" = ")._visitRaw(i[e][1])}if(e<i.length-1)this._write(", ")}this._write(";")},seq:function(t){for(var i=1;i<t.length;i++){this._visitRaw(t[i]);if(i<t.length-1)this._write(", ")}},binary:function(t){var i=t[1],e=t[2],s=t[3];function n(t){var i=t[0];return!(i=="num"||i=="name"||i=="dot")}if(n(e)){this._write("(")._visitRaw(e)._write(") ")}else{this._visitRaw(e)._write(" ")}this._write(i);if(n(s)){this._write(" (")._visitRaw(s)._write(")")}else{this._write(" ")._visitRaw(s)}},sub:function(t){var i=t[1],e=t[2];function s(){return!(i[0]=="name")}if(s()){this._write("(")._visitRaw(i)._write(")[")._visitRaw(e)._write("]")}else{this._visitRaw(i)._write("[")._visitRaw(e)._write("]")}},"unary-postfix":function(t){var i=t[1];var e=t[2];this._visitRaw(e)._write(i)},"unary-prefix":function(t){var i=t[1];var e=t[2];this._write(i);if(i=="typeof"){this._write("(")._visitRaw(e)._write(")")}else{this._visitRaw(e)}},assign:function(t){var i=t[1];var e=t[2];var s=t[3];this._visitRaw(e);if(typeof i=="string"){this._write(" "+i+"= ")}else{this._write(" = ")}this._visitRaw(s)},stat:function(t){this._visitRaw(t[1])._write(";")},dot:function(t){function i(){var i=t[1][0];return!(i=="dot"||i=="name")}if(i()){this._write("(")._visitRaw(t[1])._write(").")._write(t[2])}else{this._visitRaw(t[1])._write(".")._write(t[2])}},"new":function(t){var i=t[1];this._write("new ")._visitRaw(i)._write("(");var e=t[2];for(var s=0,n=e.length;s<n;s++){this._visitRaw(e[s]);if(s<n-1)this._write(", ")}this._write(")")},call:function(t){if(s(t)){var i=this._indent+this._indentLevel*4;var e=n(t,i);this._write(e)}else{var r=t[1][0]=="name"&&t[1][1]==this._binder;if(r){this._pos={inFunction:true};this._buffer=[]}this._visitRaw(t[1])._write("(");var _=t[2];for(var a=0;a<_.length;a++){this._visitRaw(_[a]);if(a<_.length-1)this._write(", ")}this._write(")");if(r){throw"Invalid bind operation: "+this._buffer.join("")}}},name:function(t){this._write(t[1])},object:function(t){var i=t[1];if(i.length<=0){this._write("{ }")}else{this._writeLine("{");this._indentLevel++;for(var e=0;e<i.length;e++){this._writeIndents()._write(stringify(i[e][0])+": ")._visitRaw(i[e][1]);if(e<i.length-1){this._writeLine(",")}else{this._writeLine("")}}this._indentLevel--;this._writeIndents()._write("}")}},array:function(t){this._write("[");var i=t[1];for(var e=0;e<i.length;e++){this._visitRaw(i[e]);if(e<i.length-1)this._write(", ")}this._write("]")},num:function(t){this._write(t[1])},regexp:function(t){this._write("/"+t[1]+"/"+t[2])},string:function(t){this._write(stringify(t[1]))},"function":function(t){this._visitRawFunction(t)},defun:function(t){this._visitRawFunction(t)},"return":function(t){if(this._pos.inFunction){this._write("return");var i=t[1];if(i)this._write(" ")._visitRaw(i);this._write(";")}else{this._write("return ")._visitJscex({type:"return",stmt:t})._write(";")}},"for":function(t){this._write("for (");var i=t[1];if(i){this._visitRaw(i);if(i[0]!="var"){this._write("; ")}else{this._write(" ")}}else{this._write("; ")}var e=t[2];if(e)this._visitRaw(e);this._write("; ");var s=t[3];if(s)this._visitRaw(s);this._write(") ");var n=this._pos.inLoop;this._pos.inLoop=true;var r=t[4];this._visitRawBody(r);this._pos.inLoop=n},"for-in":function(t){this._write("for (");var i=t[1];if(i[0]=="var"){this._write("var "+i[1][0][0])}else{this._visitRaw(i)}this._write(" in ")._visitRaw(t[3])._write(") ");var e=t[4];this._visitRawBody(e)},block:function(t){this._writeLine("{");this._indentLevel++;this._visitRawStatements(t[1]);this._indentLevel--;this._writeIndents()._write("}")},"while":function(t){var i=t[1];var e=t[2];var s=this._pos.inLoop;this._pos.inLoop=true;this._write("while (")._visitRaw(i)._write(") ")._visitRawBody(e);this._pos.inLoop=s},"do":function(t){var i=t[1];var e=t[2];var s=this._pos.inLoop;this._pos.inLoop=true;this._write("do ")._visitRawBody(e);this._pos.inLoop=s;if(e[0]=="block"){this._write(" ")}else{this._writeLine()._writeIndents()}this._write("while (")._visitRaw(i)._write(");")},"if":function(t){var i=t[1];var e=t[2];this._write("if (")._visitRaw(i)._write(") ")._visitRawBody(e);var s=t[3];if(s){if(e[0]=="block"){this._write(" ")}else{this._writeLine("")._writeIndents()}if(s[0]=="if"){this._write("else ")._visitRaw(s)}else{this._write("else ")._visitRawBody(s)}}},"break":function(t){if(this._pos.inLoop||this._pos.inSwitch){this._write("break;")}else{this._write("return ")._visitJscex({type:"break",stmt:t})._write(";")}},"continue":function(t){if(this._pos.inLoop){this._write("continue;")}else{this._write("return ")._visitJscex({type:"continue",stmt:t})._write(";")}},"throw":function(t){var i=this._pos;if(i.inTry||i.inFunction){this._write("throw ")._visitRaw(t[1])._write(";")}else{this._write("return ")._visitJscex({type:"throw",stmt:t})._write(";")}},conditional:function(t){this._write("(")._visitRaw(t[1])._write(") ? (")._visitRaw(t[2])._write(") : (")._visitRaw(t[3])._write(")")},"try":function(t){this._writeLine("try {");this._indentLevel++;var i=this._pos.inTry;this._pos.inTry=true;this._visitRawStatements(t[1]);this._indentLevel--;this._pos.inTry=i;var e=t[2];var s=t[3];if(e){this._writeIndents()._writeLine("} catch ("+e[0]+") {");this._indentLevel++;this._visitRawStatements(e[1]);this._indentLevel--}if(s){this._writeIndents()._writeLine("} finally {");this._indentLevel++;this._visitRawStatements(s);this._indentLevel--}this._writeIndents()._write("}")},"switch":function(t){this._write("switch (")._visitRaw(t[1])._writeLine(") {");this._indentLevel++;var i=this._pos.inSwitch;this._pos.inSwitch=true;var e=t[2];for(var s=0;s<e.length;s++){var n=e[s];this._writeIndents();if(n[0]){this._write("case ")._visitRaw(n[0])._writeLine(":")}else{this._writeLine("default:")}this._indentLevel++;this._visitRawStatements(n[1]);this._indentLevel--}this._indentLevel--;this._pos.inSwitch=i;this._writeIndents()._write("}")}}};function s(t){if(t[0]!="call")return false;var i=t[1];if(i[0]!="name"||i[1]!="eval")return false;var e=t[2][0];if(!e||e[0]!="call")return false;var s=e[1];if(!s||s[0]!="dot"||s[2]!="compile")return false;var n=s[1];if(!n||n[0]!="name"||n[1]!="Jscex")return false;var r=e[2][0];if(!r||r[0]!="string")return false;var _=e[2][1];if(!_||_[0]!="function")return false;return true}function n(s,n){var r=s[2][0][2][0][1];var _=s[2][0][2][1];var a=t.binders[r];var h=new i(a);var o=h.generate(_);var w=new e(r,a,n);var v=w.generate(_[2],o);return v}function r(i,e){var s=e.toString();var r="eval(Jscex.compile("+stringify(i)+", "+s+"))";var _=t.parse(r);var a=_[1][0][1];var h=n(a,0);t.logger.debug(s+"\n\n>>>\n\n"+h);return codeGenerator(h)}t.compile=r;t.modules["jit"]=true};var isCommonJS=typeof require!=="undefined"&&typeof module!=="undefined"&&module.exports;var isAmd=typeof define!=="undefined"&&define.amd;if(isCommonJS){module.exports.init=function(t){if(!t.modules["parser"]){require("./jscex-parser").init(t)}init(t)}}else if(isAmd){define("jscex-jit",["jscex-parser"],function(t){return{init:function(i){if(!i.modules["parser"]){t.init(i)}init(i)}}})}else{if(typeof Jscex==="undefined"){throw new Error('Missing root object, please load "jscex" module first.')}if(!Jscex.modules["parser"]){throw new Error('Missing essential components, please initialize "parser" module first.')}init(Jscex)}})();
//rebuild by neat 
// build time:Mon Nov 13 2017 19:24:11 GMT+0800 (CST)
(function(t){function e(t,e){return t+Math.floor(Math.random()*(e-t+1))}function r(t,e){var i=t[0].mul((1-e)*(1-e));var r=t[1].mul(2*e*(1-e));var o=t[2].mul(e*e);return i.add(r).add(o)}function o(t,e,i){var r=(t/i*(t/i)+e/i*(e/i)-1)*(t/i*(t/i)+e/i*(e/i)-1)*(t/i*(t/i)+e/i*(e/i)-1)-t/i*(t/i)*(e/i)*(e/i)*(e/i);return r<0}Point=function(t,e){this.x=t||0;this.y=e||0};Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(t){p=this.clone();p.x+=t.x;p.y+=t.y;return p},sub:function(t){p=this.clone();p.x-=t.x;p.y-=t.y;return p},div:function(t){p=this.clone();p.x/=t;p.y/=t;return p},mul:function(t){p=this.clone();p.x*=t;p.y*=t;return p}};Heart=function(){var t=[],e,i,r;for(var o=10;o<30;o+=.2){r=o/Math.PI;e=16*Math.pow(Math.sin(r),3);i=13*Math.cos(r)-5*Math.cos(2*r)-2*Math.cos(3*r)-Math.cos(4*r);t.push(new Point(e,i))}this.points=t;this.length=t.length};Heart.prototype={get:function(t,e){return this.points[t].mul(e||1)}};Seed=function(t,e,i,r){this.tree=t;var i=i||1;var r=r||"#FF0000";this.heart={point:e,scale:i,color:r,figure:new Heart};this.cirle={point:e,scale:i,color:r,radius:5}};Seed.prototype={draw:function(){this.drawHeart();this.drawText()},addPosition:function(t,e){this.cirle.point=this.cirle.point.add(new Point(t,e))},canMove:function(){return this.cirle.point.y<this.tree.height+20},move:function(t,e){this.clear();this.drawCirle();this.addPosition(t,e)},canScale:function(){return this.heart.scale>.2},setHeartScale:function(t){this.heart.scale*=t},scale:function(t){this.clear();this.drawCirle();this.drawHeart();this.setHeartScale(t)},drawHeart:function(){var t=this.tree.ctx,e=this.heart;var i=e.point,r=e.color,o=e.scale;t.save();t.fillStyle=r;t.translate(i.x,i.y);t.beginPath();t.moveTo(0,0);for(var n=0;n<e.figure.length;n++){var a=e.figure.get(n,o);t.lineTo(a.x,-a.y)}t.closePath();t.fill();t.restore()},drawCirle:function(){var t=this.tree.ctx,e=this.cirle;var i=e.point,r=e.color,o=e.scale,n=e.radius;t.save();t.fillStyle=r;t.translate(i.x,i.y);t.scale(o,o);t.beginPath();t.moveTo(0,0);t.arc(0,0,n,0,2*Math.PI);t.closePath();t.fill();t.restore()},drawText:function(){var t=this.tree.ctx,e=this.heart;var i=e.point,r=e.color,o=e.scale;t.save();t.strokeStyle=r;t.fillStyle=r;t.translate(i.x,i.y);t.scale(o,o);t.moveTo(0,0);t.lineTo(15,15);t.lineTo(60,15);t.stroke();t.moveTo(0,0);t.scale(.75,.75);t.font="12px 微软雅黑,Verdana";t.fillText("Come In Baby",23,10);t.restore()},clear:function(){var t=this.tree.ctx,e=this.cirle;var i=e.point,r=e.scale,o=26;var n=h=o*r;t.clearRect(i.x-n,i.y-h,4*n,4*h)},hover:function(t,e){var i=this.tree.ctx;var r=i.getImageData(t,e,1,1);return r.data[3]==255}};Footer=function(t,e,i,r){this.tree=t;this.point=new Point(t.seed.heart.point.x,t.height-i/2);this.width=e;this.height=i;this.speed=r||2;this.length=0};Footer.prototype={draw:function(){var t=this.tree.ctx,e=this.point;var i=this.length/2;t.save();t.strokeStyle="rgb(35, 31, 32)";t.lineWidth=this.height;t.lineCap="round";t.lineJoin="round";t.translate(e.x,e.y);t.beginPath();t.moveTo(0,0);t.lineTo(i,0);t.lineTo(-i,0);t.stroke();t.restore();if(this.length<this.width){this.length+=this.speed}}};Tree=function(t,e,i,r){this.canvas=t;this.ctx=t.getContext("2d");this.width=e;this.height=i;this.opt=r||{};this.record={};this.initSeed();this.initFooter();this.initBranch();this.initBloom()};Tree.prototype={initSeed:function(){var t=this.opt.seed||{};var e=t.x||this.width/2;var i=t.y||this.height/2;var r=new Point(e,i);var o=t.color||"#FF0000";var n=t.scale||1;this.seed=new Seed(this,r,n,o)},initFooter:function(){var t=this.opt.footer||{};var e=t.width||this.width;var i=t.height||5;var r=t.speed||2;this.footer=new Footer(this,e,i,r)},initBranch:function(){var t=this.opt.branch||[];this.branchs=[];this.addBranchs(t)},initBloom:function(){var t=this.opt.bloom||{};var e=[],i=t.num||500,r=t.width||this.width,o=t.height||this.height,n=this.seed.heart.figure;var a=240,h,s;for(var l=0;l<i;l++){e.push(this.createBloom(r,o,a,n))}this.blooms=[];this.bloomsCache=e},toDataURL:function(t){return this.canvas.toDataURL(t)},draw:function(t){var e=this,i=e.ctx;var r=e.record[t];if(!r){return}var o=r.point,n=r.image;i.save();i.putImageData(n,o.x,o.y);i.restore()},addBranch:function(t){this.branchs.push(t)},addBranchs:function(t){var e=this,i,r,o,n,a,h,s;for(var l=0;l<t.length;l++){i=t[l];r=new Point(i[0],i[1]);o=new Point(i[2],i[3]);n=new Point(i[4],i[5]);a=i[6];h=i[7];s=i[8];e.addBranch(new Branch(e,r,o,n,a,h,s))}},removeBranch:function(t){var e=this.branchs;for(var i=0;i<e.length;i++){if(e[i]===t){e.splice(i,1)}}},canGrow:function(){return!!this.branchs.length},grow:function(){var t=this.branchs;for(var e=0;e<t.length;e++){var i=t[e];if(i){i.grow()}}},addBloom:function(t){this.blooms.push(t)},removeBloom:function(t){var e=this.blooms;for(var i=0;i<e.length;i++){if(e[i]===t){e.splice(i,1)}}},createBloom:function(t,i,r,n,a,h,s,l,c,u){var f,p;while(true){f=e(20,t-20);p=e(20,i-20);if(o(f-t/2,i-(i-40)/2-p,r)){return new Bloom(this,new Point(f,p),n,a,h,s,l,c,u)}}},canFlower:function(){return!!this.blooms.length},flower:function(t){var e=this,i=e.bloomsCache.splice(0,t);for(var r=0;r<i.length;r++){e.addBloom(i[r])}i=e.blooms;for(var o=0;o<i.length;o++){i[o].flower()}},snapshot:function(t,e,i,r,o){var n=this.ctx;var a=n.getImageData(e,i,r,o);this.record[t]={image:a,point:new Point(e,i),width:r,height:o}},setSpeed:function(t,e){this.record[t||"move"].speed=e},move:function(t,e,r){var o=this,n=o.ctx;var a=o.record[t||"move"];var h=a.point,s=a.image,l=a.speed||10,c=a.width,u=a.height;i=h.x+l<e?h.x+l:e;j=h.y+l<r?h.y+l:r;n.save();n.clearRect(h.x,h.y,c,u);n.putImageData(s,i,j);n.restore();a.point=new Point(i,j);a.speed=l*.95;if(a.speed<2){a.speed=2}return i<e||j<r},jump:function(){var t=this,i=t.blooms;if(i.length){for(var r=0;r<i.length;r++){i[r].jump()}}if(i.length&&i.length<3||!i.length){var o=this.opt.bloom||{},n=o.width||this.width,a=o.height||this.height,h=this.seed.heart.figure;var s=240,l,c;for(var r=0;r<e(1,2);r++){i.push(this.createBloom(n/2+n,a,s,h,null,1,null,1,new Point(e(-100,600),720),e(200,300)))}}}};Branch=function(t,e,i,r,o,n,a){this.tree=t;this.point1=e;this.point2=i;this.point3=r;this.radius=o;this.length=n||100;this.len=0;this.t=1/(this.length-1);this.branchs=a||[]};Branch.prototype={grow:function(){var t=this,e;if(t.len<=t.length){e=r([t.point1,t.point2,t.point3],t.len*t.t);t.draw(e);t.len+=1;t.radius*=.97}else{t.tree.removeBranch(t);t.tree.addBranchs(t.branchs)}},draw:function(t){var e=this;var i=e.tree.ctx;i.save();i.beginPath();i.fillStyle="rgb(35, 31, 32)";i.shadowColor="rgb(35, 31, 32)";i.shadowBlur=2;i.moveTo(t.x,t.y);i.arc(t.x,t.y,e.radius,0,2*Math.PI);i.closePath();i.fill();i.restore()}};Bloom=function(t,i,r,o,n,a,h,s,l){this.tree=t;this.point=i;this.color=o||"rgb(255,"+e(0,255)+","+e(0,255)+")";this.alpha=n||e(.3,1);this.angle=a||e(0,360);this.scale=h||.1;this.place=s;this.speed=l;this.figure=r};Bloom.prototype={setFigure:function(t){this.figure=t},flower:function(){var t=this;t.draw();t.scale+=.1;if(t.scale>1){t.tree.removeBloom(t)}},draw:function(){var t=this,e=t.tree.ctx,i=t.figure;e.save();e.fillStyle=t.color;e.globalAlpha=t.alpha;e.translate(t.point.x,t.point.y);e.scale(t.scale,t.scale);e.rotate(t.angle);e.beginPath();e.moveTo(0,0);for(var r=0;r<i.length;r++){var o=i.get(r);e.lineTo(o.x,-o.y)}e.closePath();e.fill();e.restore()},jump:function(){var t=this,e=t.tree.height;if(t.point.x<-20||t.point.y>e+20){t.tree.removeBloom(t)}else{t.draw();t.point=t.place.sub(t.point).div(t.speed).add(t.point);t.angle+=.05;t.speed-=1}}};t.random=e;t.bezier=r;t.Point=Point;t.Tree=Tree})(window);
//rebuild by neat 